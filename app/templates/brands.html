<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>WPerfumes — Brands</title>

    <!-- Shared styles -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/announcements.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/brands_main.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        /* layout tweaks for brands page */
        .page-controls {
            display: flex;
            gap: 12px;
            align-items: center;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }

        .brand-grid {
            display: flex;
            flex-wrap: nowrap;
            gap: 18px;
            justify-content: flex-start;
            align-items: stretch;
        }

        .brand-card {
            width: 100%;
            height: 140px;
            /* rectangular: width > height */
            text-align: center;
            border-radius: 8px;
            background: #ffffff;
            box-shadow: 0 1px 2px #0001;
            padding: 12px;
            margin-bottom: 12px;
            transition: box-shadow 0.2s, transform 0.12s;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border: 1px solid #e6ddd9;
        }

        .brand-card:hover {
            box-shadow: 0 6px 12px #0002;
            transform: translateY(-4px);
        }

        .brand-card img {
            max-width: 60%;
            max-height: 64px;
            object-fit: contain;
            background: #fff;
            margin-bottom: 8px;
            display: block;
        }

        .brand-card h3 {
            margin: 0;
            font-size: 15px;
            font-weight: 700;
            color: #3e2723;
        }

        .brand-card p {
            display: none;
            /* hide description to keep cards clean */
        }

        .brand-count {
            font-weight: 700;
            color: #3e2723;
        }

        .controls-left {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .controls-right {
            margin-left: auto;
        }

        /* Status message shown above the cards (e.g. "Unisex Products...") */
        #brandStatus {
            margin: 12px 0;
            padding: 10px 12px;
            background: #efe5df;
            border: 1px solid #e5d6d2;
            color: #5b3f35;
            border-radius: 4px;
            font-style: italic;
        }

        @media (max-width: 1100px) {

            /* make card widths a little smaller on narrower desktops */
            .brand-grid {
                gap: 14px;
            }

            .brand-link {
                flex: 0 0 calc((100% - 56px) / 5);
                max-width: calc((100% - 56px) / 5);
            }
        }

        @media (max-width: 900px) {

            /* allow horizontal scroll for smaller screens */
            .brand-grid {
                overflow-x: auto;
                padding-bottom: 12px;
                gap: 12px;
            }

            .brand-link {
                flex: 0 0 200px;
                max-width: 200px;
            }
        }

        @media (max-width: 520px) {
            .brand-card {
                height: auto;
                padding: 10px;
            }

            .brand-card img {
                max-height: 48px;
            }

            .brand-link {
                flex: 0 0 45vw;
                max-width: 45vw;
            }
        }

        .control-input {
            padding: 8px 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            min-width: 180px;
        }

        .control-select {
            padding: 8px 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
        }

        .brand-link {
            text-decoration: none;
            color: inherit;
            display: block;
            flex: 0 0 calc((100% - 72px) / 5);
            /* 5 cards per row, subtract gap (4 * 18px = 72px) */
            max-width: calc((100% - 72px) / 5);
        }
    </style>
</head>

<body>
    {% include 'announcements.html' %}

    <!-- Promotion bar (blinking) — placed at the same visual level as the announcement bar like index.html.
         main.css contains .blinking-offer styling and animation. This element is populated by main.js (fetches
         /api/settings/checkout_discount) and will blink when a percent > 0 is returned by the admin panel.
    -->
    <div id="blinking-offer" class="blinking-offer" style="display:none;" role="status" aria-live="polite"></div>

    <nav class="navbar" role="navigation" aria-label="Main navigation">
        <div style="display:flex;align-items:center;gap:12px;">
            <a class="brand-logo" href="{{ url_for('main.index') }}">WPerfumes</a>
            <ul class="nav-tabs" role="menubar" aria-label="Site Menu">
                <li><a href="{{ url_for('main.index') }}">Home</a></li>
                <li><a href="{{ url_for('main.brands') }}">Fragrances</a></li>
                <li><a href="/price-comparison">Compare Prices</a></li>
                <li><a href="/static/pages/history.html">History</a></li>
                <li><a href="/static/pages/about.html">About Us</a></li>
            </ul>
        </div>

        <div class="navbar-center">
            <div class="search-container">
                <input id="siteSearchInput" type="text" placeholder="Search for scents, notes, or brands..."
                    aria-label="Search">
            </div>
        </div>

        <div class="navbar-right">
            <a id="cartBtn" class="cart-btn" href="{{ url_for('main.cart') }}" aria-label="Open cart">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#3e2723" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                    <circle cx="9" cy="21" r="1"></circle>
                    <circle cx="20" cy="21" r="1"></circle>
                    <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 0 0 0 2-1.61l1.38-8.19H6"></path>
                </svg>
                <span>Cart</span>
                <span id="cartCountBadge" class="cart-count-badge" style="display:none;">0</span>
            </a>
            <div class="login-menu-container">
                <a href="{{ url_for('main.login_page') }}" class="login-btn">Login</a>
                <div class="login-submenu">
                    <a href="{{ url_for('main.signup') }}" class="signup-btn">Sign Up</a>
                </div>
            </div>
        </div>
    </nav>

    <main id="pageMain" class="container" role="main" aria-live="polite" style="padding:18px 0;">
        <div style="display:flex;align-items:center;gap:12px;margin-bottom:8px;">
            <h1 class="page-title" style="margin:0;">Discover Our Brands</h1>
            <div style="margin-left:8px;color:#666;">(<span id="brandCount" class="brand-count">{{ brands|length
                    }}</span> brands)</div>
        </div>

        <div class="page-controls" aria-label="Brand filters and search">
            <div class="controls-left">
                <label for="genderFilter">Gender:</label>
                <select id="genderFilter" class="control-select" aria-label="Filter brands by gender">
                    <option value="">All</option>
                    <option value="men">Men</option>
                    <option value="women">Women</option>
                    <option value="unisex">Unisex</option>
                </select>

                <!-- Brand select restored and populated server-side as fallback -->
                <label for="brandFilter" style="margin-left:8px;">Brand:</label>
                <select id="brandFilter" class="control-select" aria-label="Filter brands by brand">
                    <option value="">All Brands</option>
                    {% for brand in brands %}
                    <option value="{{ (brand.name|replace(' ', '_')) }}">{{ brand.name }}</option>
                    {% endfor %}
                </select>

                <label for="searchBrand" style="margin-left:8px;">Search:</label>
                <input id="searchBrand" class="control-input" type="search" placeholder="Search brands by name..."
                    aria-label="Search brands by name">
            </div>

            <div class="controls-right" style="margin-left:auto;">
                <button id="showAllBtn" class="control-input"
                    style="background:#fff;border:1px solid #ddd;cursor:pointer;">Reset filters</button>
            </div>
        </div>

        <!-- Status message required by brands.js (shows current gender context and instruction) -->
        <div id="brandStatus">Unisex Products. Select a brand or use the filter above.</div>

        <div id="brandListContainer">
            <div id="brandGrid" class="brand-grid" role="list" aria-live="polite">
                {# Server-side rendered fall-back content — JS will re-render dynamic view using the same data #}
                {% for brand in brands %}
                <a class="brand-link" href="/brand?brand={{ (brand.name|replace(' ', '_')) }}"
                    aria-label="View {{ brand.name }}">
                    <div class="brand-card" role="listitem" data-brand-gender="{{ brand.gender|default('') }}">
                        <img src="{{ url_for('static', filename=brand.logo_url) }}" alt="{{ brand.name }}">
                        <h3>{{ brand.name }}</h3>
                    </div>
                </a>
                {% endfor %}
            </div>
        </div>

        <!-- pagination controls container (used by brands.js) -->
        <div id="paginationControls" class="pagination-controls" style="margin-top:18px;">
            <button id="autoSlideToggle" type="button">▶️ Start Auto-Slide</button>
        </div>
    </main>

    <section class="top-picks-section">
        <div class="content-container">
            <div class="top-picks-header">
                <div
                    style="display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--light-brown);padding-bottom:6px;">
                    <h2>Top Picks by Lifestyle</h2>
                </div>
            </div>

            <div id="dynamicTopPicksByLifestyleContainer" aria-live="polite" aria-label="Top picks by lifestyle"
                style="margin-top:12px;">
                <!-- Dynamic Top Picks will be rendered by brands.js -->
            </div>
        </div>
    </section>

    {% include 'footer.html' %}

    <script>
        // Expose static image paths to the page-level scripts
        window.PLACEHOLDER_IMG = "{{ url_for('static', filename='images/placeholder.jpg') }}";
        window.DEFAULT_PRODUCT_IMG = "{{ url_for('static', filename='images/default.jpg') }}";
        // Provide the brands data to client-side script (JSON) so client can filter without a roundtrip.
        window.BRANDS = {{ brands | tojson | safe }};
        if (!Array.isArray(window.BRANDS)) window.BRANDS = [];
    </script>

    <!-- load shared main.js and brands.js (brands.js replaces men.js) -->
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script src="{{ url_for('static', filename='js/brands.js') }}"></script>
    <script src="{{ url_for('static', filename='js/announcements.js') }}"></script>
</body>

</html>